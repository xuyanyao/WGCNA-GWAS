######Video source: https://ke.biowolf.cn
######??????学??: https://www.biowolf.cn/
######微?殴??诤牛?biowolf_cn
######???????洌biowolf@foxmail.com
######????微??: 18520221056

#install.packages("corrplot")
#install.packages("pheatmap")


#???冒?
library(pheatmap)
library(corrplot)

inputFile="CIBERSORT-Results.txt"      #????细???????慕????募?
setwd("E:\\妗\\177geoMR\\15.heatmap")     #???霉???目录

#??取????细???????募?
rt=read.table(inputFile, header=T, sep="\t", check.names=F, row.names=1)

#??取??品?姆?????息(????????实????)
con=grepl("_Control", rownames(rt), ignore.case=T)     #??????????品
treat=grepl("_Treat", rownames(rt), ignore.case=T)     #实????????品
conData=rt[con,]           #??????????细???暮?量
treatData=rt[treat,]       #实????????细???暮?量
conNum=nrow(conData)
treatNum=nrow(treatData)
data=t(rbind(conData,treatData))

#准??注???募?
data=data[apply(data,1,sd)>0,]
Type=c(rep("Control",conNum), rep("Treat",treatNum))
names(Type)=colnames(data)
Type=as.data.frame(Type)
#??????图
pdf(file="heatmap.pdf", width=7, height=4)
pheatmap(data, 
         annotation_col=Type, 
         color=colorRampPalette(c(rep("blue",3), "white", rep("red",3)))(50),
         cluster_cols=F,
         show_colnames=F,
         scale="row",
         fontsize = 7,
         fontsize_row=7,
         fontsize_col=7)
dev.off()

#??????????图??
treatData=treatData[,apply(treatData,2,sd)>0]
pdf("corHeatmap.pdf", width=12, height=12)
corrplot(corr=cor(treatData),
         method = "color",          #图?蔚?展示??式
         order = "hclust",          #????细??????????式
         tl.col="black",            #??????色
         number.cex = 0.8,          #????系????????小
         addCoef.col = "black",     #????系????????色
         col=colorRampPalette(c("blue", "white", "red"))(50),     #图?蔚???色
         )
dev.off()


######Video source: https://ke.biowolf.cn
######??????学??: https://www.biowolf.cn/
######微?殴??诤牛?biowolf_cn
######???????洌biowolf@foxmail.com
######????微??: 18520221056

