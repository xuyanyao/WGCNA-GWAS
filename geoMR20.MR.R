######Video source: https://ke.biowolf.cn
######??????学??: https://www.biowolf.cn/
######微?殴??诤牛?biowolf_cn
######???????洌biowolf@foxmail.com
######????微??: 18520221056

#install.packages("remotes")
#remotes::install_github("MRCIEU/TwoSampleMR")


#???冒?
library(TwoSampleMR)

exposureID="ebi-a-GCST90011994"         #??露????ID
outcomeID="finn-b-RHEUMA_SEROPOS_OTH"     #????????ID
setwd("E:\\妗\\楠ㄥ宠MR\\20.MR")      #???霉???目录

#??取??露????
exposure_dat <- extract_instruments(exposureID, p1=5e-06, clump=TRUE)

#??取????????
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcomeID)

#????露???莺徒??????莺喜?
dat <- harmonise_data(exposure_dat, outcome_dat)

#?????????系露????????墓??弑?量
outTab=dat[dat$mr_keep=="TRUE",]
write.csv(outTab, file="table.SNP.csv", row.names=F)

#?系露???????????
mrResult=mr(dat)
#选???系露????????姆???
#mr_method_list()$obj
#mrResult=mr(dat, method_list=c("mr_ivw", "mr_egger_regression", "mr_weighted_median", "mr_simple_mode", "mr_weighted_mode"))
#?越???????OR值?募???
mrTab=generate_odds_ratios(mrResult)
write.csv(mrTab, file="table.MRresult.csv", row.names=F)

#?????苑???
heterTab=mr_heterogeneity(dat)
write.csv(heterTab, file="table.heterogeneity.csv", row.names=F)

#??效?约???
pleioTab=mr_pleiotropy_test(dat)
write.csv(pleioTab, file="table.pleiotropy.csv", row.names=F)

#????散??图
pdf(file="pic.scatter_plot.pdf", width=7.5, height=7)
mr_scatter_plot(mrResult, dat)
dev.off()

#森??图
res_single=mr_singlesnp(dat)      #?玫?每?????弑?量?越??值?影??
pdf(file="pic.forest.pdf", width=7, height=5.5)
mr_forest_plot(res_single)
dev.off()

#漏??图
pdf(file="pic.funnel_plot.pdf", width=7, height=6.5)
mr_funnel_plot(singlesnp_results = res_single)
dev.off()

#??一???????苑???
pdf(file="pic.leaveoneout.pdf", width=7, height=5.5)
mr_leaveoneout_plot(leaveoneout_results = mr_leaveoneout(dat))
dev.off()


######Video source: https://ke.biowolf.cn
######??????学??: https://www.biowolf.cn/
######微?殴??诤牛?biowolf_cn
######???????洌biowolf@foxmail.com
######????微??: 18520221056


